{% extends "base.html" %}
{% block content %}
<h2 style="margin-bottom:1rem;">Profiles</h2>

<div style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;margin-bottom:1rem;">
  <a class="button is-link" href="/profiles/new">+ New Profile</a>

  <form method="get" action="/profiles" style="display:flex;gap:.5rem;align-items:center;">
    <input type="text" name="q" value="{{ q or '' }}" placeholder="Search by name or description…"
      style="padding:.4rem;min-width:260px;" />
    <button class="button" type="submit">Search</button>
    {% if q %}
    <a class="button is-light" href="/profiles">Clear</a>
    {% endif %}
  </form>

  <div style="margin-left:auto;color:#666;">
    {% if q %}
    <span>Showing {{ filtered_count }} of {{ total_count }}</span>
    <span style="margin-left:.5rem;">(query: “{{ q }}”)</span>
    {% else %}
    <span>Total: {{ total_count }}</span>
    {% endif %}
  </div>
</div>

{% if profiles %}
<table class="table is-striped is-fullwidth">
  <thead>
    <tr>
      <th style="width:25%;">Name</th>
      <th style="width:45%;">Description</th>
      <th style="width:20%;">Updated</th>
      <th style="width:10%; text-align:center;">Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for p in profiles %}
    <tr>
      <td><a href="/profiles/{{ p.id }}">{{ p.name }}</a></td>
      <td>{{ p.description or '' }}</td>
      <td>{{ p.updated_at.strftime("%Y-%m-%d %H:%M") if p.updated_at else '' }}</td>
      <td style="text-align:center;">
        <a href="/profiles/{{ p.id }}/edit" class="button is-small is-light">Edit</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
{% if q %}
<p>No profiles match your search.</p>
{% else %}
<p>No profiles created yet.</p>
{% endif %}
{% endif %}
{% endblock %}